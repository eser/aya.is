// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.29.0
// source: profile_questions.sql

package storage

import (
	"context"
	"database/sql"
	"time"
)

const countProfileQuestionsByProfileID = `-- name: CountProfileQuestionsByProfileID :one
SELECT COUNT(*) AS count
FROM "profile_question"
WHERE profile_id = $1
  AND deleted_at IS NULL
`

type CountProfileQuestionsByProfileIDParams struct {
	ProfileID string `db:"profile_id" json:"profile_id"`
}

// CountProfileQuestionsByProfileID
//
//	SELECT COUNT(*) AS count
//	FROM "profile_question"
//	WHERE profile_id = $1
//	  AND deleted_at IS NULL
func (q *Queries) CountProfileQuestionsByProfileID(ctx context.Context, arg CountProfileQuestionsByProfileIDParams) (int64, error) {
	row := q.db.QueryRowContext(ctx, countProfileQuestionsByProfileID, arg.ProfileID)
	var count int64
	err := row.Scan(&count)
	return count, err
}

const decrementProfileQuestionVoteCount = `-- name: DecrementProfileQuestionVoteCount :exec
UPDATE "profile_question"
SET
  vote_count = GREATEST(vote_count - 1, 0),
  updated_at = NOW()
WHERE id = $1
  AND deleted_at IS NULL
`

type DecrementProfileQuestionVoteCountParams struct {
	ID string `db:"id" json:"id"`
}

// DecrementProfileQuestionVoteCount
//
//	UPDATE "profile_question"
//	SET
//	  vote_count = GREATEST(vote_count - 1, 0),
//	  updated_at = NOW()
//	WHERE id = $1
//	  AND deleted_at IS NULL
func (q *Queries) DecrementProfileQuestionVoteCount(ctx context.Context, arg DecrementProfileQuestionVoteCountParams) error {
	_, err := q.db.ExecContext(ctx, decrementProfileQuestionVoteCount, arg.ID)
	return err
}

const deleteProfileQuestionVote = `-- name: DeleteProfileQuestionVote :exec
DELETE FROM "profile_question_vote"
WHERE question_id = $1
  AND user_id = $2
`

type DeleteProfileQuestionVoteParams struct {
	QuestionID string `db:"question_id" json:"question_id"`
	UserID     string `db:"user_id" json:"user_id"`
}

// DeleteProfileQuestionVote
//
//	DELETE FROM "profile_question_vote"
//	WHERE question_id = $1
//	  AND user_id = $2
func (q *Queries) DeleteProfileQuestionVote(ctx context.Context, arg DeleteProfileQuestionVoteParams) error {
	_, err := q.db.ExecContext(ctx, deleteProfileQuestionVote, arg.QuestionID, arg.UserID)
	return err
}

const getProfileQuestion = `-- name: GetProfileQuestion :one
SELECT id, profile_id, author_user_id, content, answer_content, answer_uri, answer_kind, answered_at, answered_by, is_anonymous, is_hidden, vote_count, created_at, updated_at, deleted_at
FROM "profile_question"
WHERE id = $1
  AND deleted_at IS NULL
`

type GetProfileQuestionParams struct {
	ID string `db:"id" json:"id"`
}

// GetProfileQuestion
//
//	SELECT id, profile_id, author_user_id, content, answer_content, answer_uri, answer_kind, answered_at, answered_by, is_anonymous, is_hidden, vote_count, created_at, updated_at, deleted_at
//	FROM "profile_question"
//	WHERE id = $1
//	  AND deleted_at IS NULL
func (q *Queries) GetProfileQuestion(ctx context.Context, arg GetProfileQuestionParams) (*ProfileQuestion, error) {
	row := q.db.QueryRowContext(ctx, getProfileQuestion, arg.ID)
	var i ProfileQuestion
	err := row.Scan(
		&i.ID,
		&i.ProfileID,
		&i.AuthorUserID,
		&i.Content,
		&i.AnswerContent,
		&i.AnswerURI,
		&i.AnswerKind,
		&i.AnsweredAt,
		&i.AnsweredBy,
		&i.IsAnonymous,
		&i.IsHidden,
		&i.VoteCount,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
	)
	return &i, err
}

const getProfileQuestionVote = `-- name: GetProfileQuestionVote :one
SELECT id, question_id, user_id, score, created_at
FROM "profile_question_vote"
WHERE question_id = $1
  AND user_id = $2
`

type GetProfileQuestionVoteParams struct {
	QuestionID string `db:"question_id" json:"question_id"`
	UserID     string `db:"user_id" json:"user_id"`
}

// GetProfileQuestionVote
//
//	SELECT id, question_id, user_id, score, created_at
//	FROM "profile_question_vote"
//	WHERE question_id = $1
//	  AND user_id = $2
func (q *Queries) GetProfileQuestionVote(ctx context.Context, arg GetProfileQuestionVoteParams) (*ProfileQuestionVote, error) {
	row := q.db.QueryRowContext(ctx, getProfileQuestionVote, arg.QuestionID, arg.UserID)
	var i ProfileQuestionVote
	err := row.Scan(
		&i.ID,
		&i.QuestionID,
		&i.UserID,
		&i.Score,
		&i.CreatedAt,
	)
	return &i, err
}

const incrementProfileQuestionVoteCount = `-- name: IncrementProfileQuestionVoteCount :exec
UPDATE "profile_question"
SET
  vote_count = vote_count + 1,
  updated_at = NOW()
WHERE id = $1
  AND deleted_at IS NULL
`

type IncrementProfileQuestionVoteCountParams struct {
	ID string `db:"id" json:"id"`
}

// IncrementProfileQuestionVoteCount
//
//	UPDATE "profile_question"
//	SET
//	  vote_count = vote_count + 1,
//	  updated_at = NOW()
//	WHERE id = $1
//	  AND deleted_at IS NULL
func (q *Queries) IncrementProfileQuestionVoteCount(ctx context.Context, arg IncrementProfileQuestionVoteCountParams) error {
	_, err := q.db.ExecContext(ctx, incrementProfileQuestionVoteCount, arg.ID)
	return err
}

const insertProfileQuestion = `-- name: InsertProfileQuestion :one
INSERT INTO "profile_question" (
  id,
  profile_id,
  author_user_id,
  content,
  is_anonymous,
  created_at
) VALUES (
  $1,
  $2,
  $3,
  $4,
  $5,
  NOW()
) RETURNING id, profile_id, author_user_id, content, answer_content, answer_uri, answer_kind, answered_at, answered_by, is_anonymous, is_hidden, vote_count, created_at, updated_at, deleted_at
`

type InsertProfileQuestionParams struct {
	ID           string `db:"id" json:"id"`
	ProfileID    string `db:"profile_id" json:"profile_id"`
	AuthorUserID string `db:"author_user_id" json:"author_user_id"`
	Content      string `db:"content" json:"content"`
	IsAnonymous  bool   `db:"is_anonymous" json:"is_anonymous"`
}

// InsertProfileQuestion
//
//	INSERT INTO "profile_question" (
//	  id,
//	  profile_id,
//	  author_user_id,
//	  content,
//	  is_anonymous,
//	  created_at
//	) VALUES (
//	  $1,
//	  $2,
//	  $3,
//	  $4,
//	  $5,
//	  NOW()
//	) RETURNING id, profile_id, author_user_id, content, answer_content, answer_uri, answer_kind, answered_at, answered_by, is_anonymous, is_hidden, vote_count, created_at, updated_at, deleted_at
func (q *Queries) InsertProfileQuestion(ctx context.Context, arg InsertProfileQuestionParams) (*ProfileQuestion, error) {
	row := q.db.QueryRowContext(ctx, insertProfileQuestion,
		arg.ID,
		arg.ProfileID,
		arg.AuthorUserID,
		arg.Content,
		arg.IsAnonymous,
	)
	var i ProfileQuestion
	err := row.Scan(
		&i.ID,
		&i.ProfileID,
		&i.AuthorUserID,
		&i.Content,
		&i.AnswerContent,
		&i.AnswerURI,
		&i.AnswerKind,
		&i.AnsweredAt,
		&i.AnsweredBy,
		&i.IsAnonymous,
		&i.IsHidden,
		&i.VoteCount,
		&i.CreatedAt,
		&i.UpdatedAt,
		&i.DeletedAt,
	)
	return &i, err
}

const insertProfileQuestionVote = `-- name: InsertProfileQuestionVote :one
INSERT INTO "profile_question_vote" (
  id,
  question_id,
  user_id,
  score,
  created_at
) VALUES (
  $1,
  $2,
  $3,
  $4,
  NOW()
) RETURNING id, question_id, user_id, score, created_at
`

type InsertProfileQuestionVoteParams struct {
	ID         string `db:"id" json:"id"`
	QuestionID string `db:"question_id" json:"question_id"`
	UserID     string `db:"user_id" json:"user_id"`
	Score      int32  `db:"score" json:"score"`
}

// InsertProfileQuestionVote
//
//	INSERT INTO "profile_question_vote" (
//	  id,
//	  question_id,
//	  user_id,
//	  score,
//	  created_at
//	) VALUES (
//	  $1,
//	  $2,
//	  $3,
//	  $4,
//	  NOW()
//	) RETURNING id, question_id, user_id, score, created_at
func (q *Queries) InsertProfileQuestionVote(ctx context.Context, arg InsertProfileQuestionVoteParams) (*ProfileQuestionVote, error) {
	row := q.db.QueryRowContext(ctx, insertProfileQuestionVote,
		arg.ID,
		arg.QuestionID,
		arg.UserID,
		arg.Score,
	)
	var i ProfileQuestionVote
	err := row.Scan(
		&i.ID,
		&i.QuestionID,
		&i.UserID,
		&i.Score,
		&i.CreatedAt,
	)
	return &i, err
}

const isProfileQAHidden = `-- name: IsProfileQAHidden :one
SELECT hide_qa
FROM "profile"
WHERE id = $1
`

type IsProfileQAHiddenParams struct {
	ID string `db:"id" json:"id"`
}

// IsProfileQAHidden
//
//	SELECT hide_qa
//	FROM "profile"
//	WHERE id = $1
func (q *Queries) IsProfileQAHidden(ctx context.Context, arg IsProfileQAHiddenParams) (bool, error) {
	row := q.db.QueryRowContext(ctx, isProfileQAHidden, arg.ID)
	var hide_qa bool
	err := row.Scan(&hide_qa)
	return hide_qa, err
}

const listProfileQuestionsByProfileID = `-- name: ListProfileQuestionsByProfileID :many
SELECT
  pq.id, pq.profile_id, pq.author_user_id, pq.content, pq.answer_content, pq.answer_uri, pq.answer_kind, pq.answered_at, pq.answered_by, pq.is_anonymous, pq.is_hidden, pq.vote_count, pq.created_at, pq.updated_at, pq.deleted_at,
  CASE
    WHEN $1::TEXT IS NOT NULL THEN
      EXISTS(
        SELECT 1 FROM "profile_question_vote" pqv
        WHERE pqv.question_id = pq.id
          AND pqv.user_id = $1::TEXT
      )
    ELSE FALSE
  END AS has_viewer_vote
FROM "profile_question" pq
WHERE pq.profile_id = $2
  AND pq.deleted_at IS NULL
  AND ($3::BOOLEAN = TRUE OR pq.is_hidden = FALSE)
ORDER BY pq.vote_count DESC, pq.created_at DESC
`

type ListProfileQuestionsByProfileIDParams struct {
	ViewerUserID  sql.NullString `db:"viewer_user_id" json:"viewer_user_id"`
	ProfileID     string         `db:"profile_id" json:"profile_id"`
	IncludeHidden bool           `db:"include_hidden" json:"include_hidden"`
}

type ListProfileQuestionsByProfileIDRow struct {
	ID            string         `db:"id" json:"id"`
	ProfileID     string         `db:"profile_id" json:"profile_id"`
	AuthorUserID  string         `db:"author_user_id" json:"author_user_id"`
	Content       string         `db:"content" json:"content"`
	AnswerContent sql.NullString `db:"answer_content" json:"answer_content"`
	AnswerURI     sql.NullString `db:"answer_uri" json:"answer_uri"`
	AnswerKind    sql.NullString `db:"answer_kind" json:"answer_kind"`
	AnsweredAt    sql.NullTime   `db:"answered_at" json:"answered_at"`
	AnsweredBy    sql.NullString `db:"answered_by" json:"answered_by"`
	IsAnonymous   bool           `db:"is_anonymous" json:"is_anonymous"`
	IsHidden      bool           `db:"is_hidden" json:"is_hidden"`
	VoteCount     int32          `db:"vote_count" json:"vote_count"`
	CreatedAt     time.Time      `db:"created_at" json:"created_at"`
	UpdatedAt     sql.NullTime   `db:"updated_at" json:"updated_at"`
	DeletedAt     sql.NullTime   `db:"deleted_at" json:"deleted_at"`
	HasViewerVote bool           `db:"has_viewer_vote" json:"has_viewer_vote"`
}

// ListProfileQuestionsByProfileID
//
//	SELECT
//	  pq.id, pq.profile_id, pq.author_user_id, pq.content, pq.answer_content, pq.answer_uri, pq.answer_kind, pq.answered_at, pq.answered_by, pq.is_anonymous, pq.is_hidden, pq.vote_count, pq.created_at, pq.updated_at, pq.deleted_at,
//	  CASE
//	    WHEN $1::TEXT IS NOT NULL THEN
//	      EXISTS(
//	        SELECT 1 FROM "profile_question_vote" pqv
//	        WHERE pqv.question_id = pq.id
//	          AND pqv.user_id = $1::TEXT
//	      )
//	    ELSE FALSE
//	  END AS has_viewer_vote
//	FROM "profile_question" pq
//	WHERE pq.profile_id = $2
//	  AND pq.deleted_at IS NULL
//	  AND ($3::BOOLEAN = TRUE OR pq.is_hidden = FALSE)
//	ORDER BY pq.vote_count DESC, pq.created_at DESC
func (q *Queries) ListProfileQuestionsByProfileID(ctx context.Context, arg ListProfileQuestionsByProfileIDParams) ([]*ListProfileQuestionsByProfileIDRow, error) {
	rows, err := q.db.QueryContext(ctx, listProfileQuestionsByProfileID, arg.ViewerUserID, arg.ProfileID, arg.IncludeHidden)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []*ListProfileQuestionsByProfileIDRow{}
	for rows.Next() {
		var i ListProfileQuestionsByProfileIDRow
		if err := rows.Scan(
			&i.ID,
			&i.ProfileID,
			&i.AuthorUserID,
			&i.Content,
			&i.AnswerContent,
			&i.AnswerURI,
			&i.AnswerKind,
			&i.AnsweredAt,
			&i.AnsweredBy,
			&i.IsAnonymous,
			&i.IsHidden,
			&i.VoteCount,
			&i.CreatedAt,
			&i.UpdatedAt,
			&i.DeletedAt,
			&i.HasViewerVote,
		); err != nil {
			return nil, err
		}
		items = append(items, &i)
	}
	if err := rows.Close(); err != nil {
		return nil, err
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateProfileQuestionAnswer = `-- name: UpdateProfileQuestionAnswer :exec
UPDATE "profile_question"
SET
  answer_content = $1,
  answer_uri = $2,
  answer_kind = $3,
  answered_at = NOW(),
  answered_by = $4,
  updated_at = NOW()
WHERE id = $5
  AND deleted_at IS NULL
`

type UpdateProfileQuestionAnswerParams struct {
	AnswerContent sql.NullString `db:"answer_content" json:"answer_content"`
	AnswerURI     sql.NullString `db:"answer_uri" json:"answer_uri"`
	AnswerKind    sql.NullString `db:"answer_kind" json:"answer_kind"`
	AnsweredBy    sql.NullString `db:"answered_by" json:"answered_by"`
	ID            string         `db:"id" json:"id"`
}

// UpdateProfileQuestionAnswer
//
//	UPDATE "profile_question"
//	SET
//	  answer_content = $1,
//	  answer_uri = $2,
//	  answer_kind = $3,
//	  answered_at = NOW(),
//	  answered_by = $4,
//	  updated_at = NOW()
//	WHERE id = $5
//	  AND deleted_at IS NULL
func (q *Queries) UpdateProfileQuestionAnswer(ctx context.Context, arg UpdateProfileQuestionAnswerParams) error {
	_, err := q.db.ExecContext(ctx, updateProfileQuestionAnswer,
		arg.AnswerContent,
		arg.AnswerURI,
		arg.AnswerKind,
		arg.AnsweredBy,
		arg.ID,
	)
	return err
}

const updateProfileQuestionHidden = `-- name: UpdateProfileQuestionHidden :exec
UPDATE "profile_question"
SET
  is_hidden = $1,
  updated_at = NOW()
WHERE id = $2
  AND deleted_at IS NULL
`

type UpdateProfileQuestionHiddenParams struct {
	IsHidden bool   `db:"is_hidden" json:"is_hidden"`
	ID       string `db:"id" json:"id"`
}

// UpdateProfileQuestionHidden
//
//	UPDATE "profile_question"
//	SET
//	  is_hidden = $1,
//	  updated_at = NOW()
//	WHERE id = $2
//	  AND deleted_at IS NULL
func (q *Queries) UpdateProfileQuestionHidden(ctx context.Context, arg UpdateProfileQuestionHiddenParams) error {
	_, err := q.db.ExecContext(ctx, updateProfileQuestionHidden, arg.IsHidden, arg.ID)
	return err
}
